<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Token ç®¡ç†</title>
    <!-- é˜²æ­¢é¡µé¢é—ªçƒï¼šåœ¨æ¸²æŸ“å‰æ ¹æ®TabçŠ¶æ€è®¾ç½®åˆå§‹æ˜¾ç¤º -->
    <script>
        (function () {
            // åˆå§‹çŠ¶æ€ï¼šauth-checking è¡¨ç¤ºæ­£åœ¨éªŒè¯ç™»å½•çŠ¶æ€
            // éªŒè¯å®Œæˆåä¼šå˜æˆ auth-ready + logged-in æˆ– auth-ready
            var currentTab = localStorage.getItem('currentTab') || 'tokens';
            var classes = ['auth-checking'];
            if (currentTab === 'settings') classes.push('tab-settings');
            if (currentTab === 'logs') classes.push('tab-logs');
            document.documentElement.className = classes.join(' ');
            // æ£€æµ‹å­—ä½“åŠ è½½
            if ('fonts' in document) {
                document.fonts.ready.then(function () {
                    document.documentElement.classList.add('fonts-loaded');
                });
            } else {
                // åå¤‡æ–¹æ¡ˆï¼šå»¶è¿Ÿæ·»åŠ 
                setTimeout(function () {
                    document.documentElement.classList.add('fonts-loaded');
                }, 1000);
            }
        })();
    </script>
    <style>
        /* éªŒè¯ä¸­çŠ¶æ€ï¼šéšè—ç™»å½•æ¡†å’Œä¸»å†…å®¹ï¼Œæ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨ */
        html.auth-checking #loginForm,
        html.auth-checking #mainContent {
            display: none !important;
        }

        html.auth-checking #authLoading {
            display: flex !important;
        }

        /* éªŒè¯å®Œæˆåï¼šéšè—åŠ è½½æŒ‡ç¤ºå™¨ */
        html.auth-ready #authLoading {
            display: none !important;
        }

        /* ç™»å½•çŠ¶æ€æ˜¾ç¤ºæ§åˆ¶ */
        .logged-in #loginForm {
            display: none !important;
        }

        .logged-in #mainContent {
            display: flex !important;
        }

        html.auth-ready:not(.logged-in) #loginForm {
            display: block !important;
        }

        html.auth-ready:not(.logged-in) #mainContent {
            display: none !important;
        }

        /* TabçŠ¶æ€ç®¡ç† */
        html.tab-settings #tokensPage {
            display: none !important;
        }

        html.tab-settings #settingsPage {
            display: block !important;
        }

        html.tab-settings #logsPage {
            display: none !important;
        }

        html.tab-settings .tab[data-tab="tokens"] {
            background: transparent !important;
            color: var(--text-light, #888) !important;
        }

        html.tab-settings .tab[data-tab="settings"] {
            background: var(--primary, #4f46e5) !important;
            color: white !important;
        }

        html.tab-settings .tab[data-tab="logs"] {
            background: transparent !important;
            color: var(--text-light, #888) !important;
        }

        html.tab-logs #tokensPage {
            display: none !important;
        }

        html.tab-logs #settingsPage {
            display: none !important;
        }

        html.tab-logs #logsPage {
            display: flex !important;
        }

        html.tab-logs #geminicliPage {
            display: none !important;
        }

        html.tab-logs .tab[data-tab="tokens"] {
            background: transparent !important;
            color: var(--text-light, #888) !important;
        }

        html.tab-logs .tab[data-tab="settings"] {
            background: transparent !important;
            color: var(--text-light, #888) !important;
        }

        html.tab-logs .tab[data-tab="logs"] {
            background: var(--primary, #4f46e5) !important;
            color: white !important;
        }

        html.tab-logs .tab[data-tab="geminicli"] {
            background: transparent !important;
            color: var(--text-light, #888) !important;
        }

        /* Gemini CLI Tab çŠ¶æ€ */
        html.tab-geminicli #tokensPage {
            display: none !important;
        }

        html.tab-geminicli #settingsPage {
            display: none !important;
        }

        html.tab-geminicli #logsPage {
            display: none !important;
        }

        html.tab-geminicli #geminicliPage {
            display: block !important;
        }

        html.tab-geminicli .tab[data-tab="tokens"] {
            background: transparent !important;
            color: var(--text-light, #888) !important;
        }

        html.tab-geminicli .tab[data-tab="settings"] {
            background: transparent !important;
            color: var(--text-light, #888) !important;
        }

        html.tab-geminicli .tab[data-tab="logs"] {
            background: transparent !important;
            color: var(--text-light, #888) !important;
        }

        html.tab-geminicli .tab[data-tab="geminicli"] {
            background: var(--primary, #4f46e5) !important;
            color: white !important;
        }

        html.tab-settings #geminicliPage {
            display: none !important;
        }

        html.tab-settings .tab[data-tab="geminicli"] {
            background: transparent !important;
            color: var(--text-light, #888) !important;
        }

        /* åŠ è½½æŒ‡ç¤ºå™¨æ ·å¼ */
        #authLoading {
            display: none;
            position: fixed;
            inset: 0;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 1rem;
            background: var(--bg, #f8fafc);
        }

        #authLoading .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border, #e2e8f0);
            border-top-color: var(--primary, #0891b2);
            border-radius: 50%;
            animation: spin 0.7s linear infinite;
        }

        #authLoading .loading-text {
            color: var(--text-light, #64748b);
            font-size: 0.875rem;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
    <!-- ä¸»æ ·å¼è¡¨ - ä¼˜å…ˆåŠ è½½ -->
    <link rel="stylesheet" href="style.css">
    <!-- é¢„è¿æ¥å­—ä½“æœåŠ¡å™¨ -->
    <link rel="preconnect" href="https://font.sec.miui.com" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- å­—ä½“å¼‚æ­¥åŠ è½½ - ä¸é˜»å¡æ¸²æŸ“ -->
    <link rel="stylesheet"
        href="https://font.sec.miui.com/font/css?family=MiSans:400,500,600,700:Chinese_Simplify,Latin&display=swap"
        media="print" onload="this.media='all'">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu+Mono:wght@400;700&display=swap"
        media="print" onload="this.media='all'">
    <noscript>
        <link rel="stylesheet"
            href="https://font.sec.miui.com/font/css?family=MiSans:400,500,600,700:Chinese_Simplify,Latin&display=swap">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu+Mono:wght@400;700&display=swap">
    </noscript>
</head>

<body>
    <!-- éªŒè¯ç™»å½•çŠ¶æ€æ—¶çš„åŠ è½½æŒ‡ç¤ºå™¨ -->
    <div id="authLoading">
        <div class="spinner"></div>
        <div class="loading-text">æ­£åœ¨éªŒè¯ç™»å½•çŠ¶æ€...</div>
    </div>

    <div class="container">
        <!-- ç™»å½•è¡¨å• -->
        <div id="loginForm" class="login-form">
            <h2>Token ç®¡ç†</h2>
            <form id="login">
                <div class="form-group">
                    <label>ğŸ‘¤ ç”¨æˆ·å</label>
                    <input type="text" id="username" required autocomplete="username">
                </div>
                <div class="form-group">
                    <label>ğŸ”‘ å¯†ç </label>
                    <input type="password" id="password" required autocomplete="current-password">
                </div>
                <button type="submit">ç™»å½•</button>
            </form>
        </div>

        <!-- ä¸»å†…å®¹ -->
        <div id="mainContent" class="main-content hidden">
            <div class="header">
            <div class="tabs">
                <button class="tab active" data-tab="tokens" onclick="switchTab('tokens')"><span
                        class="tab-icon">ğŸ¯</span><span class="tab-text">Token</span></button>
                <button class="tab" data-tab="geminicli" onclick="switchTab('geminicli')"><span
                        class="tab-icon">ğŸ’</span><span class="tab-text">CLI</span></button>
                <button class="tab" data-tab="settings" onclick="switchTab('settings')"><span
                        class="tab-icon">âš™ï¸</span><span class="tab-text">è®¾ç½®</span></button>
                <button class="tab" data-tab="logs" onclick="switchTab('logs')"><span
                        class="tab-icon">ğŸ“‹</span><span class="tab-text">æ—¥å¿—</span></button>
            </div>
                <div class="header-right">
                    <button onclick="logout()">ğŸšª é€€å‡º</button>
                </div>
            </div>
            <div class="content">
                <!-- Tokenç®¡ç†é¡µé¢ -->
                <div id="tokensPage">
                    <!-- ç»Ÿè®¡å¡ç‰‡ + æ“ä½œæŒ‰é’® -->
                    <div class="top-bar">
                        <div class="stats-inline">
                            <div class="stat-item clickable active" onclick="filterTokens('all')">
                                <span class="stat-num" id="totalTokens">0</span>
                                <span class="stat-text">æ€»æ•°</span>
                            </div>
                            <div class="stat-item success clickable" onclick="filterTokens('enabled')">
                                <span class="stat-num" id="enabledTokens">0</span>
                                <span class="stat-text">å¯ç”¨</span>
                            </div>
                            <div class="stat-item danger clickable" onclick="filterTokens('disabled')">
                                <span class="stat-num" id="disabledTokens">0</span>
                                <span class="stat-text">ç¦ç”¨</span>
                            </div>
                            <button type="button" class="action-toggle-btn" id="actionToggleBtn"
                                onclick="toggleActionBar()" title="æ”¶èµ·æ“ä½œæŒ‰é’®">â–¾</button>
                        </div>
                        <div class="action-btns" id="actionBar">
                            <button type="button" onclick="showOAuthModal()" class="btn btn-success btn-sm">ğŸ”
                                OAuth</button>
                            <button type="button" onclick="toggleSensitiveInfo()" class="btn btn-secondary btn-sm"
                                id="toggleSensitiveBtn" title="ç‚¹å‡»æ˜¾ç¤ºæ•æ„Ÿä¿¡æ¯">ğŸ™ˆ éšè—</button>
                            <button type="button" onclick="refreshAllQuotas()" class="btn btn-info btn-sm"
                                id="refreshQuotasBtn">ğŸ“Š åˆ·æ–°é¢åº¦</button>
                            <button type="button" onclick="batchFetchProjectIds()" class="btn btn-info btn-sm"
                                title="æ‰¹é‡è·å–æ‰€æœ‰å¯ç”¨Tokençš„Project ID">ğŸ” æ‰¹é‡è·å–</button>
                            <button type="button" onclick="loadTokens()" class="btn btn-warning btn-sm">ğŸ”„ é‡è½½</button>
                            <button type="button" onclick="exportTokens()" class="btn btn-sm"
                                style="background: var(--primary);" title="å¯¼å‡ºToken">ğŸ“¤ å¯¼å‡º</button>
                            <button type="button" onclick="importTokens()" class="btn btn-sm"
                                style="background: var(--primary);" title="æ·»åŠ /å¯¼å…¥Token">ğŸ“¥ å¯¼å…¥</button>
                        </div>
                    </div>

                    <!-- Tokenç½‘æ ¼ -->
                    <div id="tokenList" class="token-grid">
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ“¦</div>
                            <div class="empty-state-text">æš‚æ— Token</div>
                            <div class="empty-state-hint">ç‚¹å‡»ä¸Šæ–¹OAuthæŒ‰é’®æ·»åŠ Token</div>
                        </div>
                    </div>
                </div>

                <!-- Gemini CLI é¡µé¢ -->
                <div id="geminicliPage" class="hidden">
                    <!-- ç»Ÿè®¡å¡ç‰‡ + æ“ä½œæŒ‰é’® -->
                    <div class="top-bar">
                        <div class="stats-inline">
                            <div class="stat-item clickable active" onclick="filterGeminiCliTokens('all')">
                                <span class="stat-num" id="geminicliTotalTokens">0</span>
                                <span class="stat-text">æ€»æ•°</span>
                            </div>
                            <div class="stat-item success clickable" onclick="filterGeminiCliTokens('enabled')">
                                <span class="stat-num" id="geminicliEnabledTokens">0</span>
                                <span class="stat-text">å¯ç”¨</span>
                            </div>
                            <div class="stat-item danger clickable" onclick="filterGeminiCliTokens('disabled')">
                                <span class="stat-num" id="geminicliDisabledTokens">0</span>
                                <span class="stat-text">ç¦ç”¨</span>
                            </div>
                        </div>
                        <div class="action-btns">
                            <button type="button" onclick="showGeminiCliOAuthModal()" class="btn btn-success btn-sm">ğŸ”
                                OAuth</button>
                            <button type="button" onclick="toggleSensitiveInfo()" class="btn btn-secondary btn-sm"
                                title="ç‚¹å‡»æ˜¾ç¤ºæ•æ„Ÿä¿¡æ¯">ğŸ™ˆ éšè—</button>
                            <button type="button" onclick="reloadGeminiCliTokens()" class="btn btn-warning btn-sm">ğŸ”„ é‡è½½</button>
                            <button type="button" onclick="exportGeminiCliTokens()" class="btn btn-sm"
                                style="background: var(--primary);" title="å¯¼å‡ºToken">ğŸ“¤ å¯¼å‡º</button>
                            <button type="button" onclick="importGeminiCliTokens()" class="btn btn-sm"
                                style="background: var(--primary);" title="æ·»åŠ /å¯¼å…¥Token">ğŸ“¥ å¯¼å…¥</button>
                        </div>
                    </div>

                    <!-- Tokenç½‘æ ¼ -->
                    <div id="geminicliTokenList" class="token-grid">
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ“¦</div>
                            <div class="empty-state-text">æš‚æ— Gemini CLI Token</div>
                            <div class="empty-state-hint">ç‚¹å‡»ä¸Šæ–¹OAuthæŒ‰é’®æ·»åŠ Token</div>
                        </div>
                    </div>
                </div>

                <!-- æ—¥å¿—é¡µé¢ -->
                <div id="logsPage" class="hidden">
                    <div class="logs-top-bar">
                        <div class="logs-top-row">
                            <div id="logStats" class="log-stats">
                                <!-- æ—¥å¿—ç»Ÿè®¡å°†ç”± JS æ¸²æŸ“ -->
                            </div>
                        </div>
                        <div class="logs-second-row">
                            <div class="log-search">
                                <input type="text" id="logSearchInput" placeholder="æœç´¢æ—¥å¿—..."
                                    oninput="searchLogs(this.value)">
                            </div>
                            <div class="log-action-btns">
                                <button id="autoRefreshBtn" class="btn btn-sm btn-secondary"
                                    onclick="toggleAutoRefresh()" title="æ¯3ç§’è‡ªåŠ¨åˆ·æ–°æ—¥å¿—">ğŸ”„ è‡ªåŠ¨åˆ·æ–°</button>
                                <button class="btn btn-sm btn-info" onclick="loadLogs(); loadLogStats();"
                                    title="æ‰‹åŠ¨åˆ·æ–°æ—¥å¿—">â†» åˆ·æ–°</button>
                                <button class="btn btn-sm" style="background: var(--primary);" onclick="exportLogs()"
                                    title="å¯¼å‡ºæ—¥å¿—ä¸ºæ–‡æœ¬æ–‡ä»¶">ğŸ“¤ å¯¼å‡º</button>
                                <button class="btn btn-sm btn-danger" onclick="clearLogs()" title="æ¸…ç©ºæ‰€æœ‰æ—¥å¿—">ğŸ—‘ï¸
                                    æ¸…ç©º</button>
                            </div>
                        </div>
                    </div>
                    <div class="log-container">
                        <div id="logList" class="log-list">
                            <div class="log-empty">
                                <div class="log-empty-icon">ğŸ“‹</div>
                                <div class="log-empty-text">åŠ è½½ä¸­...</div>
                            </div>
                        </div>
                    </div>
                    <button id="loadMoreLogsBtn" class="btn btn-secondary load-more-btn" onclick="loadMoreLogs()"
                        style="display: none;">åŠ è½½æ›´å¤š</button>
                </div>

                <!-- è®¾ç½®é¡µé¢ -->
                <div id="settingsPage" class="hidden">
                    <form id="configForm" class="config-form">
                        <div class="settings-layout">
                            <aside class="settings-nav">
                                <div class="settings-search">
                                    <input type="text" id="settingsSearch" placeholder="æœç´¢è®¾ç½®..."
                                        oninput="filterSettings(this.value)">
                                </div>
                                <select class="settings-section-select" id="settingsSectionSelect"
                                    onchange="setActiveSettingSection(this.value, true)">
                                    <option value="section-server">ğŸ–¥ï¸ æœåŠ¡å™¨</option>
                                    <option value="section-model">ğŸ›ï¸ æ¨¡å‹å‚æ•°</option>
                                    <option value="section-rotation">ğŸ”„ è½®è¯¢ä¸æ€§èƒ½</option>
                                    <option value="section-security">ğŸ›¡ï¸ å®‰å…¨ç®¡ç†</option>
                                </select>
                                <div class="settings-nav-list">
                                    <button type="button" class="settings-nav-item" data-target="section-server"
                                        onclick="setActiveSettingSection('section-server', true)">ğŸ–¥ï¸ æœåŠ¡å™¨</button>
                                    <button type="button" class="settings-nav-item" data-target="section-model"
                                        onclick="setActiveSettingSection('section-model', true)">ğŸ›ï¸ æ¨¡å‹å‚æ•°</button>
                                    <button type="button" class="settings-nav-item" data-target="section-rotation"
                                        onclick="setActiveSettingSection('section-rotation', true)">ğŸ”„ è½®è¯¢ä¸æ€§èƒ½</button>
                                    <button type="button" class="settings-nav-item" data-target="section-security"
                                        onclick="setActiveSettingSection('section-security', true)">ğŸ›¡ï¸ å®‰å…¨ç®¡ç†</button>
                                </div>
                            </aside>
                            <div class="settings-content">
                                <div class="config-grid">
                                    <!-- æœåŠ¡å™¨é…ç½® -->
                                    <div class="config-section" id="section-server">
                                        <h4>ğŸ–¥ï¸ æœåŠ¡å™¨</h4>
                                        <div class="form-row-inline">
                                            <div class="form-group compact">
                                                <label>ç«¯å£</label>
                                                <input type="number" name="PORT" placeholder="8045">
                                            </div>
                                            <div class="form-group compact">
                                                <label>ç›‘å¬åœ°å€</label>
                                                <input type="text" name="HOST" placeholder="0.0.0.0">
                                            </div>
                                        </div>
                                        <div class="form-group compact">
                                            <label>API ç¯å¢ƒ <span class="help-tip"
                                                    data-tooltip="é€‰æ‹©ä½¿ç”¨ sandbox æˆ– production ç¯å¢ƒçš„ API æ¥å£">?</span></label>
                                            <select name="API_USE" id="apiUseSelect">
                                                <option value="sandbox">Sandbox (æµ‹è¯•)</option>
                                                <option value="production">Production (ç”Ÿäº§)</option>
                                            </select>
                                        </div>
                                        <div class="form-row-inline">
                                            <div class="form-group compact">
                                                <label>æœ€å¤§è¯·æ±‚å¤§å°</label>
                                                <input type="text" name="MAX_REQUEST_SIZE" placeholder="500mb">
                                            </div>
                                            <div class="form-group compact">
                                                <label>APIå¯†é’¥</label>
                                                <input type="password" name="API_KEY" placeholder="ç•™ç©ºåˆ™ä¸éªŒè¯">
                                            </div>
                                        </div>
                                        <div class="form-row-inline switch-row">
                                            <div class="form-group compact switch-group">
                                                <label>è·³è¿‡éªŒè¯ <span class="help-tip"
                                                        data-tooltip="è·³è¿‡ProjectIdè·å–ï¼Œç›´æ¥éšæœºç”Ÿæˆï¼ˆä»…Proè´¦å·ï¼‰">?</span></label>
                                                <label class="switch">
                                                    <input type="checkbox" name="SKIP_PROJECT_ID_FETCH">
                                                    <span class="slider"></span>
                                                </label>
                                            </div>
                                            <div class="form-group compact switch-group">
                                                <label>åŸç”ŸAxios <span class="help-tip"
                                                        data-tooltip="ä½¿ç”¨åŸç”Ÿaxiosè€ŒéTLSæŒ‡çº¹è¯·æ±‚å™¨">?</span></label>
                                                <label class="switch">
                                                    <input type="checkbox" name="USE_NATIVE_AXIOS">
                                                    <span class="slider"></span>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="form-group compact">
                                            <label>å›¾ç‰‡è®¿é—®é“¾æ¥</label>
                                            <input type="text" name="IMAGE_BASE_URL"
                                                placeholder="https://your-domain.zeabur.app">
                                        </div>
                                        <div class="form-group compact">
                                            <label>ä»£ç†åœ°å€</label>
                                            <input type="text" name="PROXY" placeholder="http://127.0.0.1:7890">
                                        </div>
                                    </div>

                                    <!-- æ¨¡å‹é»˜è®¤å‚æ•° -->
                                    <div class="config-section" id="section-model">
                                        <h4>ğŸ›ï¸ æ¨¡å‹å‚æ•°</h4>
                                        <div class="form-row-inline">
                                            <div class="form-group compact">
                                                <label>æ¸©åº¦</label>
                                                <input type="number" step="0.1" name="DEFAULT_TEMPERATURE"
                                                    placeholder="1">
                                            </div>
                                            <div class="form-group compact">
                                                <label>Top P</label>
                                                <input type="number" step="0.01" name="DEFAULT_TOP_P" placeholder="1">
                                            </div>
                                        </div>
                                        <div class="form-row-inline">
                                            <div class="form-group compact">
                                                <label>Top K</label>
                                                <input type="number" name="DEFAULT_TOP_K" placeholder="50">
                                            </div>
                                            <div class="form-group compact">
                                                <label>æœ€å¤§Token</label>
                                                <input type="number" name="DEFAULT_MAX_TOKENS" placeholder="32000">
                                            </div>
                                        </div>
                                        <div class="form-group compact highlight">
                                            <label>æ€è€ƒé¢„ç®— <span class="help-tip"
                                                    data-tooltip="æ€è€ƒæ¨¡å‹çš„æ€è€ƒtokené¢„ç®—ï¼Œå½±å“æ¨ç†æ·±åº¦">?</span></label>
                                            <input type="number" name="DEFAULT_THINKING_BUDGET" placeholder="16000">
                                        </div>
                                        <div class="form-row-inline switch-row">
                                            <div class="form-group compact switch-group">
                                                <label>ä¸Šä¸‹æ–‡System <span class="help-tip"
                                                        data-tooltip="å¼€å¯åï¼Œå°†ç”¨æˆ·è¯·æ±‚çš„systemæ¶ˆæ¯è¿½åŠ åˆ°åä»£æç¤ºè¯åé¢">?</span></label>
                                                <label class="switch">
                                                    <input type="checkbox" name="USE_CONTEXT_SYSTEM_PROMPT"
                                                        id="useContextSystemPrompt"
                                                        onchange="handleContextSystemChange()">
                                                    <span class="slider"></span>
                                                </label>
                                            </div>
                                            <div class="form-group compact switch-group">
                                                <label>åˆå¹¶æç¤ºè¯ <span class="help-tip"
                                                        data-tooltip="å¼€å¯åï¼Œå°†æ‰€æœ‰ç³»ç»Ÿæç¤ºè¯åˆå¹¶ä¸ºå•ä¸ªpartï¼ˆéœ€è¦å…ˆå¼€å¯ä¸Šä¸‹æ–‡Systemï¼‰">?</span></label>
                                                <label class="switch">
                                                    <input type="checkbox" name="MERGE_SYSTEM_PROMPT"
                                                        id="mergeSystemPrompt" checked>
                                                    <span class="slider"></span>
                                                </label>
                                            </div>
                                            <div class="form-group compact switch-group">
                                                <label>å‡éæµ <span class="help-tip"
                                                        data-tooltip="éæµå¼è¯·æ±‚ä½¿ç”¨æµå¼è·å–æ•°æ®ï¼Œæœ€ç»ˆè¿”å›éæµå¼æ ¼å¼çš„JSONï¼ˆæ›´å¿«ï¼‰">?</span></label>
                                                <label class="switch">
                                                    <input type="checkbox" name="FAKE_NON_STREAM" checked>
                                                    <span class="slider"></span>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="form-row-inline">
                                            <div class="form-group compact">
                                                <label>å®˜æ–¹æç¤ºè¯ä½ç½® <span class="help-tip"
                                                        data-tooltip="å®˜æ–¹æç¤ºè¯ç›¸å¯¹äºåä»£æç¤ºè¯çš„ä½ç½®">?</span></label>
                                                <select name="OFFICIAL_PROMPT_POSITION">
                                                    <option value="before">åœ¨åä»£æç¤ºè¯å‰é¢</option>
                                                    <option value="after">åœ¨åä»£æç¤ºè¯åé¢</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group compact">
                                            <label>åä»£ç³»ç»Ÿæç¤ºè¯ <span class="restore-default"
                                                    onclick="restoreDefaultSystemInstruction()" title="æ¢å¤é»˜è®¤">â†»
                                                    æ¢å¤é»˜è®¤</span></label>
                                            <textarea name="SYSTEM_INSTRUCTION" rows="3"
                                                placeholder="åä»£ç³»ç»Ÿæç¤ºè¯ï¼ˆç•™ç©ºåˆ™ä¸ä½¿ç”¨ï¼‰"></textarea>
                                        </div>
                                        <div class="form-group compact">
                                            <label>
                                                å®˜æ–¹ç³»ç»Ÿæç¤ºè¯ <span class="help-tip" data-tooltip="åé‡åŠ›å®˜æ–¹è¦æ±‚çš„ç³»ç»Ÿæç¤ºè¯">?</span>
                                                <span class="restore-default"
                                                    onclick="restoreDefaultOfficialSystemPrompt()" title="æ¢å¤é»˜è®¤"
                                                    id="restoreOfficialBtn" style="display:none;">â†» æ¢å¤é»˜è®¤</span>
                                            </label>
                                            <div class="textarea-wrapper">
                                                <textarea name="OFFICIAL_SYSTEM_PROMPT" id="officialSystemPrompt"
                                                    rows="5" placeholder="å®˜æ–¹ç³»ç»Ÿæç¤ºè¯ï¼ˆç•™ç©ºåˆ™ä¸ä½¿ç”¨ï¼‰" readonly></textarea>
                                                <div class="textarea-lock-btn" id="unlockOfficialBtn"
                                                    onclick="unlockOfficialSystemPrompt()" title="ç‚¹å‡»è§£é”ä¿®æ”¹">ğŸ”’</div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- è½®è¯¢ç­–ç•¥ä¸æ€§èƒ½ä¼˜åŒ– -->
                                    <div class="config-section" id="section-rotation">
                                        <h4>ğŸ”„ è½®è¯¢ä¸æ€§èƒ½</h4>
                                        <div class="form-row-inline switch-row">
                                            <div class="form-group compact switch-group">
                                                <label>é€ä¼ ç­¾å <span class="help-tip"
                                                        data-tooltip="å°†å“åº”ä¸­çš„thoughtSignatureé€ä¼ åˆ°å®¢æˆ·ç«¯">?</span></label>
                                                <label class="switch">
                                                    <input type="checkbox" name="PASS_SIGNATURE_TO_CLIENT">
                                                    <span class="slider"></span>
                                                </label>
                                            </div>
                                            <div class="form-group compact switch-group">
                                                <label>å…œåº•ç­¾å <span class="help-tip"
                                                        data-tooltip="æ²¡æœ‰ç¼“å­˜ç­¾åæ—¶ï¼Œä½¿ç”¨å†…ç½®é»˜è®¤ç­¾åè‡ªåŠ¨è¡¥å…¨">?</span></label>
                                                <label class="switch">
                                                    <input type="checkbox" name="USE_FALLBACK_SIGNATURE">
                                                    <span class="slider"></span>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="form-row-inline switch-row">
                                            <div class="form-group compact switch-group">
                                                <label>ç¼“å­˜æ‰€æœ‰ç­¾å <span class="help-tip"
                                                        data-tooltip="å¼€å¯åç¼“å­˜æ‰€æœ‰ç­¾å">?</span></label>
                                                <label class="switch">
                                                    <input type="checkbox" name="CACHE_ALL_SIGNATURES">
                                                    <span class="slider"></span>
                                                </label>
                                            </div>
                                            <div class="form-group compact switch-group">
                                                <label>å·¥å…·ç­¾å <span class="help-tip"
                                                        data-tooltip="ä½¿ç”¨å·¥å…·æ—¶ç¼“å­˜ç­¾å">?</span></label>
                                                <label class="switch">
                                                    <input type="checkbox" name="CACHE_TOOL_SIGNATURES" checked>
                                                    <span class="slider"></span>
                                                </label>
                                            </div>
                                            <div class="form-group compact switch-group">
                                                <label>å›¾åƒç­¾å <span class="help-tip"
                                                        data-tooltip="ä½¿ç”¨å›¾åƒæ¨¡å‹æ—¶ç¼“å­˜ç­¾å">?</span></label>
                                                <label class="switch">
                                                    <input type="checkbox" name="CACHE_IMAGE_SIGNATURES" checked>
                                                    <span class="slider"></span>
                                                </label>
                                            </div>
                                            <div class="form-group compact switch-group">
                                                <label>ç¼“å­˜æ€è€ƒ <span class="help-tip"
                                                        data-tooltip="ç¼“å­˜æ€è€ƒå†…å®¹ï¼Œéšç­¾åä¸€èµ·è¿”å›">?</span></label>
                                                <label class="switch">
                                                    <input type="checkbox" name="CACHE_THINKING" checked>
                                                    <span class="slider"></span>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="form-row-inline">
                                            <div class="form-group compact">
                                                <label>ç­–ç•¥æ¨¡å¼ <span class="help-tip"
                                                        data-tooltip="å‡è¡¡è´Ÿè½½ï¼šæ¯æ¬¡è¯·æ±‚åˆ‡æ¢Token&#10;é¢åº¦è€—å°½ï¼šç”¨å®Œé¢åº¦æ‰åˆ‡æ¢&#10;è‡ªå®šä¹‰æ¬¡æ•°ï¼šæŒ‡å®šæ¬¡æ•°ååˆ‡æ¢">?</span></label>
                                                <select name="ROTATION_STRATEGY" id="rotationStrategy"
                                                    onchange="toggleRequestCountInput()">
                                                    <option value="round_robin">å‡è¡¡è´Ÿè½½</option>
                                                    <option value="quota_exhausted">é¢åº¦è€—å°½åˆ‡æ¢</option>
                                                    <option value="request_count">è‡ªå®šä¹‰æ¬¡æ•°</option>
                                                </select>
                                            </div>
                                            <div class="form-group compact" id="requestCountGroup">
                                                <label>æ¯Tokenè¯·æ±‚æ¬¡æ•° <span class="help-tip"
                                                        data-tooltip="è‡ªå®šä¹‰æ¬¡æ•°æ¨¡å¼ä¸‹ï¼Œæ¯ä¸ªTokenå¤„ç†å¤šå°‘æ¬¡è¯·æ±‚ååˆ‡æ¢">?</span></label>
                                                <input type="number" name="ROTATION_REQUEST_COUNT" min="1"
                                                    placeholder="10">
                                            </div>
                                        </div>
                                        <div class="rotation-status" id="rotationStatus">
                                            <span class="rotation-label">å½“å‰çŠ¶æ€:</span>
                                            <span id="currentRotationInfo">åŠ è½½ä¸­...</span>
                                        </div>
                                        <div class="form-row-inline">
                                            <div class="form-group compact">
                                                <label>è¶…æ—¶(ms)</label>
                                                <input type="number" name="TIMEOUT" placeholder="300000">
                                            </div>
                                            <div class="form-group compact">
                                                <label>429/503é‡è¯•æ¬¡æ•°</label>
                                                <input type="number" name="RETRY_TIMES" placeholder="0">
                                            </div>
                                        </div>

                                        <div class="form-row-inline">
                                            <div class="form-group compact">
                                                <label>å¿ƒè·³é—´éš”(ms) <span class="help-tip"
                                                        data-tooltip="SSEå¿ƒè·³é—´éš”ï¼Œé˜²æ­¢CFè¶…æ—¶æ–­è¿">?</span></label>
                                                <input type="number" name="HEARTBEAT_INTERVAL" placeholder="15000">
                                            </div>
                                            <div class="form-group compact">
                                                <label>å†…å­˜æ¸…ç†é—´éš”(ms) <span class="help-tip"
                                                        data-tooltip="æŒ‰å›ºå®šé—´éš”è§¦å‘ç¼“å­˜/å¯¹è±¡æ± æ¸…ç†">?</span></label>
                                                <input type="number" name="MEMORY_CLEANUP_INTERVAL"
                                                    placeholder="1800000">
                                            </div>
                                        </div>
                                        <div class="form-group compact">
                                            <label>ğŸ”¤ ç•Œé¢å­—ä½“å¤§å° (px)</label>
                                            <div class="font-size-control">
                                                <input type="range" id="fontSizeRange" min="10" max="24" value="18"
                                                    oninput="changeFontSize(this.value)">
                                                <input type="number" id="fontSizeInput" min="10" max="24" value="18"
                                                    onchange="changeFontSize(this.value)" style="width: 60px;">
                                            </div>
                                        </div>
                                    </div>

                                    <!-- å®‰å…¨ç®¡ç† -->
                                    <div class="config-section" id="section-security">
                                        <h4>ğŸ›¡ï¸ å®‰å…¨ç®¡ç†</h4>
                                        <div class="form-group compact switch-group">
                                            <label>å¯ç”¨å°ç¦ <span class="help-tip"
                                                    data-tooltip="å¼€å¯åè‡ªåŠ¨å°ç¦é¢‘ç¹è¿è§„çš„IPåœ°å€">?</span></label>
                                            <label class="switch">
                                                <input type="checkbox" id="blockingEnabled">
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                        <div class="security-info">
                                            <p>IPå°ç¦æœºåˆ¶ï¼šè‡ªåŠ¨è¯†åˆ«å¹¶å°ç¦é¢‘ç¹è¿è§„çš„IPåœ°å€</p>
                                            <ul>
                                                <li>5åˆ†é’Ÿå†…50æ¬¡è¿è§„ â†’ ä¸´æ—¶å°ç¦1å°æ—¶</li>
                                                <li>ç´¯è®¡10æ¬¡ä¸´æ—¶å°ç¦ â†’ æ°¸ä¹…å°ç¦</li>
                                                <li>å†…ç½‘IPè‡ªåŠ¨ç™½åå•ï¼ˆ127.xã€10.xã€172.16-31.xã€192.168.xï¼‰</li>
                                            </ul>
                                        </div>
                                        <div class="blocked-ips-header">
                                            <h5>å°ç¦åˆ—è¡¨</h5>
                                            <button type="button" onclick="loadBlockedIPs()" class="btn btn-sm btn-info">ğŸ”„ åˆ·æ–°</button>
                                        </div>
                                        <div id="blockedIPsList" class="blocked-ips-list">
                                            <div class="empty-state-small">åŠ è½½ä¸­...</div>
                                        </div>
                                        <div class="whitelist-section">
                                            <h5>ç™½åå•ç®¡ç†</h5>
                                            <div class="whitelist-input-group">
                                                <input type="text" id="whitelistIPInput" placeholder="è¾“å…¥IPåœ°å€" />
                                                <button type="button" onclick="addWhitelistIP()" class="btn btn-sm btn-success">â• æ·»åŠ </button>
                                            </div>
                                            <div id="whitelistIPsList" class="whitelist-ips-list"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="config-actions">
                                    <button type="button" onclick="loadConfig()" class="btn btn-secondary">ğŸ”„
                                        é‡æ–°åŠ è½½</button>
                                    <button type="submit" class="btn btn-success">ğŸ’¾ ä¿å­˜é…ç½®</button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- æŒ‰ä¾èµ–é¡ºåºåŠ è½½æ¨¡å— -->
    <script src="js/utils.js" defer></script>
    <script src="js/ui.js" defer></script>
    <script src="js/auth.js" defer></script>
    <script src="js/quota.js" defer></script>
    <script src="js/tokens.js" defer></script>
    <script src="js/geminicli.js" defer></script>
    <script src="js/config.js" defer></script>
    <script src="js/security.js" defer></script>
    <script src="js/logs.js" defer></script>
    <script src="js/main.js" defer></script>
</body>

</html>